apiVersion: operator.vilaverde.rocks/v1alpha1
kind: CounterMeasure
metadata:
  name: patch-strategic-action
spec:
  prometheus:
    service:
      name: prometheus-operated
      namespace: monitoring
    alert:
      name: HTTP_404
      includePending: false
  actions:
  - name: change-env
    patch:
      patchType: application/strategic-merge-patch+json
      yamlTemplate: |
        spec:
          template:
            spec: 
              containers:
              - name: main
                env:
                - name: ENV.0
                  value: '{{ range (index .Object.spec.template.spec.containers 0).env }}{{- if eq .name "ENV.1" }}{{ .value }}{{- end -}}{{ end }}'
                - name: ENV.1
                  value: '{{ range (index .Object.spec.template.spec.containers 0).env }}{{- if eq .name "ENV.0" }}{{ .value }}{{- end -}}{{ end }}'
      targetObjectRef: 
        apiVersion: apps/v1
        kind: Deployment
        name: monitored-app
        namespace: ns-custom
        
        
